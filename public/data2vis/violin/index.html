<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>小提琴图 - Songqi Duan | 段松岐</title>
    <meta property="og:title" content="小提琴图 - Songqi Duan | 段松岐">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="小提琴图允许可视化一个或几个组的数字变量的分布。每一个 &amp;ldquo;小提琴 &amp;ldquo;代表一个组或一个变量，其形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。它真的很接近于boxplot，但可以更深入地了解分布情况。
这里有一个例子显示了人们是如何看待概率的。在reddit的/r/samplesize &amp;hellip;">
      <meta property="og:description" content="小提琴图允许可视化一个或几个组的数字变量的分布。每一个 &amp;ldquo;小提琴 &amp;ldquo;代表一个组或一个变量，其形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。它真的很接近于boxplot，但可以更深入地了解分布情况。
这里有一个例子显示了人们是如何看待概率的。在reddit的/r/samplesize &amp;hellip;">
      
    

    
    
    <meta name="twitter:image" content="https://www.data-to-viz.com/graph/violin_files/figure-html/unnamed-chunk-1-1.png">
    
    
    
    

    

    
    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="stylesheet" href="../../css/fonts.css" />
    
<script async src="../../js/load-typekit.js"></script>


<link rel="stylesheet" href="../../css/custom.css" />

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?696e1454db28f84c6d4e8a1c3218da75";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  </head>

  
  <body class="data2vis">
    <header class="masthead">
      

<h1><a href="../../"><img src="../../images/logo.png" alt="Songqi Duan" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="../../">首页</a></li>
  
  <li><a href="../../data2vis/">R Gallery</a></li>
  
  <li><a href="../../data2vis/caveats">Python Gallery</a></li>
  
  

<li class="menu-extra"></li>



<li><a href="https://github.com/zerostwo/songqi.online/edit/master/content/data2vis/2020-10-04-violin.md" target="_blank">编辑</a></li>


<li><a href="../../data2vis/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>小提琴图</h1>


<h3>
2020-10-04</h3>

<hr>


      </header>


 <nav id="TableOfContents">
  <ul>
    <li><a href="#定义">定义</a>
      <ul>
        <li><a href="#可以用来做什么">可以用来做什么</a></li>
        <li><a href="#小提琴图变体">小提琴图变体</a></li>
      </ul>
    </li>
    <li><a href="#注意事项">注意事项</a></li>
    <li><a href="#如何绘制">如何绘制</a></li>
  </ul>
</nav> 
<h2 id="定义">定义</h2>
<p>小提琴图允许可视化一个或几个组的数字变量的分布。每一个 &ldquo;小提琴 &ldquo;代表一个组或一个变量，其形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。形状代表变量的密度估计：特定范围内的数据点越多，该范围内的小提琴越大。它真的很接近于boxplot，但可以更深入地了解分布情况。</p>
<p>这里有一个例子显示了人们是如何看待概率的。在reddit的/r/samplesize帖子上，有人问了这样的问题：你会给 &ldquo;高度可能 &ldquo;这个词分配什么概率。0到100之间的答案被记录下来，以下是每个问题的分布。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># Libraries</span>
<span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(hrbrthemes)
<span style="color:#a6e22e">library</span>(viridis)

<span style="color:#75715e"># Load dataset from github</span>
data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;https://raw.githubusercontent.com/zonination/perceptions/master/probly.csv&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>)
data <span style="color:#f92672">&lt;-</span> data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">gather</span>(key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span>, value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(text <span style="color:#f92672">=</span> <span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;\\.&#34;</span>, <span style="color:#e6db74">&#34; &#34;</span>,text)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(value <span style="color:#f92672">=</span> <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">as.numeric</span>(value),<span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(text <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Almost Certainly&#34;</span>,<span style="color:#e6db74">&#34;Very Good Chance&#34;</span>,<span style="color:#e6db74">&#34;We Believe&#34;</span>,<span style="color:#e6db74">&#34;Likely&#34;</span>,<span style="color:#e6db74">&#34;About Even&#34;</span>, <span style="color:#e6db74">&#34;Little Chance&#34;</span>, <span style="color:#e6db74">&#34;Chances Are Slight&#34;</span>, <span style="color:#e6db74">&#34;Almost No Chance&#34;</span>))

<span style="color:#75715e"># Plot</span>
data <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(text <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_reorder</span>(text, value)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">ggplot</span>( <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>text, y<span style="color:#f92672">=</span>value, fill<span style="color:#f92672">=</span>text, color<span style="color:#f92672">=</span>text)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_violin</span>(width<span style="color:#f92672">=</span><span style="color:#ae81ff">2.1</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">scale_fill_viridis</span>(discrete<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">scale_color_viridis</span>(discrete<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">theme_ipsum</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">theme</span>(
      legend.position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;none&#34;</span>
    ) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">coord_flip</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Assigned Probability (%)&#34;</span>)
</code></pre></div><p><img src="https://www.data-to-viz.com/graph/violin_files/figure-html/unnamed-chunk-1-1.png" alt=""></p>
<h3 id="可以用来做什么">可以用来做什么</h3>
<p>Violin plot是一种强大的数据可视化技术，因为它可以比较几个组的排名和分布。令人惊讶的是，它比boxplot使用得更少，尽管在我看来它提供的信息更多。</p>
<p>当数据量巨大，而显示单个观测值变得不可能时，小提琴特别适应。对于小数据集，带抖动的boxplot可能是一个更好的选择，因为它真正显示了所有的信息。</p>
<h3 id="小提琴图变体">小提琴图变体</h3>
<ul>
<li>小提琴图大部分时间都是垂直制作的。如果标签较长，则像上面一样构建水平版本可使标签更具可读性。</li>
<li>可以在小提琴中显示箱形图：可以一目了然地评估中位数和四分位数。有关更多信息，请参见箱线图部分。</li>
<li>如果将变量分组，则可以像对箱图进行操作一样构建分组的小提琴。这是一个示例，显示取决于一周中的一天的男女小费。</li>
</ul>
<h2 id="注意事项">注意事项</h2>
<ul>
<li>如果你比较的组别样本量非常不同，请显示出来；</li>
<li>按中值排序的组别使图表更有深度；</li>
<li>如果你只有几组，你可能对山脊线图感兴趣。</li>
</ul>
<h2 id="如何绘制">如何绘制</h2>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="../../data2vis/histogram/">直方图</a></span>
  <span class="nav-next"></span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/data2vis\/histogram\/';
    
  } else if (e.which == 39) {  
    
  }
  if (url) window.location = url;
});
</script>



<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/songqi.online" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//duansq.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




<script async src="../../js/fix-toc.js"></script>

<script async src="../../js/center-img.js"></script>

<script async src="../../js/right-quote.js"></script>

<script async src="../../js/no-highlight.js"></script>

<script async src="../../js/fix-footnote.js"></script>

<script async src="../../js/math-code.js"></script>

<script async src="../../js/external-link.js"></script>

<script async src="../../js/alt-title.js"></script>

<script async src="../../js/header-link.js"></script>



<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>


  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="../../">Songqi Duan</a> 2018 - 2020</div>
  
  </footer>
  </article>
  
  </body>
</html>

